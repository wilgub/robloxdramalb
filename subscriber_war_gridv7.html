<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube Subscriber War Grid</title>
    <style>
        body { background: black; color: white; font-family: Arial; margin: 0; overflow-x: hidden; }
        .grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; padding: 10px; }
        .channel { 
            background: #222; 
            border-radius: 5px; 
            padding: 5px 10px; 
            display: flex; 
            align-items: center; 
            width: 500px; 
            height: 70px; 
            position: relative; 
            overflow: hidden; 
            transition: box-shadow 0.3s ease;
        }
        .rank { width: 30px; font-weight: bold; text-align: center; }
        .icon { width: 40px; height: 40px; border-radius: 50%; margin: 0 10px; }
        .name { flex-grow: 1; font-size: 2em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .subs { font-size: 1.5em; font-weight: bold; }
        .views, .videos, .subchange { font-size: 0.8em; color: #ccc; }
        
        /* Background + Progress Bar */
        .bar { position: absolute; top: 0; left: 0; height: 100%; background: rgba(255,255,255,0.05); z-index: 0; }
        .progress { position: absolute; top: 0; left: 0; height: 100%; background: rgba(255,255,255,0.15); z-index: 0; transition: width 1s ease; }
        
        .content { position: relative; z-index: 1; display: flex; align-items: center; width: 100%; justify-content: space-between; }
        .milestone { position: absolute; bottom: 0; left: 0; height: 5px; background: silver; transition: width 1s ease; }
        .up { color: lime; margin-left: 5px; }
        .down { color: red; margin-left: 5px; }
        .stats { display: flex; flex-direction: column; align-items: flex-end; }

        /* Glow animations */
        @keyframes glowGreen { 0% { box-shadow: 0 0 15px lime; } 100% { box-shadow: 0 0 0 transparent; } }
        @keyframes glowRed { 0% { box-shadow: 0 0 15px red; } 100% { box-shadow: 0 0 0 transparent; } }
        .channel.glow-green { animation: glowGreen 3s ease-out; }
        .channel.glow-red { animation: glowRed 3s ease-out; }

        /* Rank change fade (yellow) */
        @keyframes rankFlash { 0% { background-color: yellow; } 100% { background-color: #222; } }
        .channel.rank-flash { animation: rankFlash 1s ease-out; }

        /* Milestone celebration (rainbow pulse) */
        @keyframes milestonePulse {
            0% { box-shadow: 0 0 20px red; }
            25% { box-shadow: 0 0 20px orange; }
            50% { box-shadow: 0 0 20px lime; }
            75% { box-shadow: 0 0 20px cyan; }
            100% { box-shadow: 0 0 20px magenta; }
        }
        .channel.milestone-hit { animation: milestonePulse 2s ease-out; }

        /* Rank change arrows */
        .rankchange { font-size: 0.8em; margin-left: 2px; }
        .rankchange.up { color: lime; }
        .rankchange.down { color: red; }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background-color: red;
            animation: fall 3s linear forwards;
            z-index: 9999;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="grid" id="channelGrid"></div>
    <audio id="ding" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script>
    const API_KEY = 'AIzaSyBhzS9zvb_YIoGjLFK_2PUVWg7DOM9MWkQ';
    const CHANNEL_IDS = [
        'UCJIzSiJ7SA2JnSJJ_KTdWvg','UCG9eIbDI-5D04HYAfnifkFg','UCSSfq3nNRhpV7uh0NfBYxvg',
        'UCTr7Cuz7BPx7RRVT9ndsaQQ','UCRZNK7dbTiHBUkd9hwaZDJA','UC2oOiUYu0GYrsfCNfDZs19A',
        'UCqW4mNcfy3IKQFW6mYmTtqQ','UCh-W5cTLc5sXxleeLdDmEJQ','UC4g8pkNStIIZQh_1-x683bw',
        'UChCOVi74ie9UT9eVzghmzwQ','UCQYVxZQ4lvl3l3PBqsxZPzQ','UCl4dgr3JyEoGynzprgVKCiw',
        'UCLi6NOe4mVDXT3A8D35uTtA','UCxsk7hqE_CwZWGEJEkGanbA','UCeTHlZPakKqOuZGRoa1MtGw',
        'UCEthz-XSiZd4UL7tR2bMWxg','UC6d5y6tfAoLzFpQvd3n-Mmg','UC9HVLEJMzmTCvtulkalfC1g',
        'UCTmYVQ3C86ZP2q6V7uWo6FA','UCH02Kkvu2LApOZHR2OxvCNw','UCvy3wEU58NdyosdvPCc1TYA',
        'UCo2ATFnvR-lCE4xdCqDN6xA','UCVrbbklk1J0gYOcQcwHp6Ag','UC5_Vv00KGbxioPg5s6bfhzA',
        'UC4arQjm34o25Iw7C3ZClgrQ','UCNDM34DrGtb3SzJEG4fSXvg','UCWA0iYgVuD-e2mNthhnuA_Q',
        'UCTK2hDxZbhUpxX0_nd7IauA','UC_b4qNyN1fsRBgd_BIhH64g',
    ];

    let channelData = {};
    let history24h = {};
    let lastHourRanks = {};
    let lastSubs = {};
    let lastMilestone = {};

    function animateValue(element, start, end, duration = 800) {
        const range = end - start;
        const startTime = performance.now();
        function update(time) {
            let progress = Math.min((time - startTime) / duration, 1);
            let value = Math.round(start + range * progress);
            element.textContent = value.toLocaleString();
            if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

    function launchConfetti() {
        for (let i = 0; i < 50; i++) {
            const conf = document.createElement('div');
            conf.className = 'confetti';
            conf.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`;
            conf.style.left = `${Math.random() * window.innerWidth}px`;
            conf.style.top = `-10px`;
            conf.style.transform = `rotate(${Math.random()*360}deg)`;
            document.body.appendChild(conf);
            setTimeout(()=>conf.remove(), 3000);
        }
    }

    async function fetchData() {
        const url = `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${CHANNEL_IDS.join(',')}&key=${API_KEY}`;
        const res = await fetch(url);
        const data = await res.json();

        data.items.forEach(item => {
            let id = item.id;
            let subs = parseInt(item.statistics.subscriberCount);
            let views = parseInt(item.statistics.viewCount);
            let videos = parseInt(item.statistics.videoCount);

            if (!channelData[id]) {
                channelData[id] = { estimatedSubs: subs, lastAPI: subs, growthPerSec: 0 };
            } else {
                let diff = subs - channelData[id].lastAPI;
                channelData[id].growthPerSec = diff / 10; 
                channelData[id].lastAPI = subs;
            }

            if (!history24h[id]) history24h[id] = [];
            history24h[id].push(subs);
            if (history24h[id].length > 1440) history24h[id].shift();

            channelData[id].id = id;
            channelData[id].name = item.snippet.title;
            channelData[id].icon = item.snippet.thumbnails.default.url;
            channelData[id].views = views;
            channelData[id].videos = videos;
            channelData[id].estimatedSubs = subs;
        });

        updateGrid();
    }

    function getCurrentMilestone(subs) {
        if (subs >= 100000000) return 100000000;
        if (subs >= 10000000) return 10000000;
        if (subs >= 1000000) return 1000000;
        if (subs >= 100000) return 100000;
        return 0;
    }

    function updateGrid() {
        let channels = Object.values(channelData).map(ch => ({
            id: ch.id,
            name: ch.name,
            icon: ch.icon,
            subs: Math.round(ch.estimatedSubs),
            views: ch.views,
            videos: ch.videos,
            sub24hChange: history24h[ch.id] ? ch.estimatedSubs - history24h[ch.id][0] : 0
        }));

        channels.sort((a, b) => b.subs - a.subs);
        let maxSubs = channels[0]?.subs || 1;

        channels.forEach((ch, i) => {
            if (!lastHourRanks[ch.id]) lastHourRanks[ch.id] = i + 1;
        });

        let html = '';
        channels.forEach((ch, index) => {
            let barWidth = (ch.subs / maxSubs) * 100;

            let milestones = [100000, 1000000, 10000000, 100000000];
            let currentMilestone = 0;
            let nextMilestone = milestones[0];
            for (let i = 0; i < milestones.length; i++) {
                if (ch.subs >= milestones[i]) {
                    currentMilestone = milestones[i];
                    nextMilestone = milestones[i + 1] || milestones[i];
                } else break;
            }
            let progress = ((ch.subs - currentMilestone) / (nextMilestone - currentMilestone)) * 100;
            let milestoneColor = currentMilestone >= 10000000 ? 'red' :
                                 currentMilestone >= 1000000 ? 'lightblue' :
                                 currentMilestone >= 100000 ? 'gold' : 'silver';

            let lastRank = lastHourRanks[ch.id] ?? index + 1;
            let rankDiff = lastRank - (index + 1);
            let rankArrow = '';
            if (rankDiff > 0) rankArrow = `<span class="rankchange up">▲${rankDiff}</span>`;
            else if (rankDiff < 0) rankArrow = `<span class="rankchange down">▼${Math.abs(rankDiff)}</span>`;

            let subChangeArrow = ch.sub24hChange > 0 ? `<span class="up">▲ ${Math.round(ch.sub24hChange)}</span>` :
                                 ch.sub24hChange < 0 ? `<span class="down">▼ ${Math.abs(Math.round(ch.sub24hChange))}</span>` : '';

            let classes = [];
            if (lastSubs[ch.id] != null) {
                if (ch.subs > lastSubs[ch.id]) classes.push('glow-green');
                if (ch.subs < lastSubs[ch.id]) classes.push('glow-red');
            }
            lastSubs[ch.id] = ch.subs;

            if (rankDiff !== 0) classes.push('rank-flash');

            let currentMilestoneHit = getCurrentMilestone(ch.subs);
            if (!lastMilestone[ch.id]) lastMilestone[ch.id] = currentMilestoneHit;
            if (currentMilestoneHit > lastMilestone[ch.id]) {
                classes.push('milestone-hit');
                lastMilestone[ch.id] = currentMilestoneHit;
                launchConfetti();
                document.getElementById('ding').play();
            }

            html += `
                <div class="channel ${classes.join(' ')}">
                    <div class="bar"></div>
                    <div class="progress" style="width:${barWidth}%"></div>
                    <div class="milestone" style="width:${progress}%; background:${milestoneColor}"></div>
                    <div class="content">
                        <div style="display:flex;align-items:center;gap:10px;">
                            <div class="rank">#${index + 1}${rankArrow}</div>
                            <img src="${ch.icon}" class="icon">
                            <div class="name">${ch.name}</div>
                        </div>
                        <div class="stats">
                            <div class="subs" id="subs-${ch.id}">${ch.subs.toLocaleString()}</div>
                            <div class="subchange">${subChangeArrow}</div>
                            <div class="views">Views: ${ch.views.toLocaleString()}</div>
                            <div class="videos">Videos: ${ch.videos}</div>
                        </div>
                    </div>
                </div>
            `;
        });

        const grid = document.getElementById('channelGrid');
        grid.innerHTML = html;

        channels.forEach(ch => {
            let el = document.getElementById(`subs-${ch.id}`);
            let oldValue = parseInt(el.textContent.replace(/,/g, '')) || ch.subs;
            animateValue(el, oldValue, ch.subs, 800);
        });
    }

    setInterval(() => {
        let channels = Object.values(channelData)
            .sort((a,b) => b.estimatedSubs - a.estimatedSubs);
        channels.forEach((ch,i) => lastHourRanks[ch.id] = i+1);
    }, 3600000);
// Test animations on console command 'animtest'
window.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    let command = window.lastConsoleCommand?.trim().toLowerCase();
    if (command === 'animtest') {
      console.log('Running animation test!');

      // Rank-up flash on all channels
      Object.values(channelData).forEach(ch => {
        const el = document.getElementById(`ch-${ch.id}`);
        if (el) {
          el.classList.add('rank-flash');
          setTimeout(() => el.classList.remove('rank-flash'), 1000);
        }
      });

      // Milestone animation + confetti + sound on all channels
      Object.values(channelData).forEach(ch => {
        const el = document.getElementById(`ch-${ch.id}`);
        if (el) {
          el.classList.add('milestone-hit');
          launchConfetti();
          document.getElementById('ding').play();
          setTimeout(() => el.classList.remove('milestone-hit'), 2000);
        }
      });
    }
    window.lastConsoleCommand = '';
  } else if (e.key.length === 1) {
    window.lastConsoleCommand = (window.lastConsoleCommand || '') + e.key;
  } else if (e.key === 'Backspace') {
    window.lastConsoleCommand = (window.lastConsoleCommand || '').slice(0, -1);
  }
});

    fetchData();
    setInterval(fetchData, 10000);
</script>
</body>
</html>
